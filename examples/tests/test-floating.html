<!DOCTYPE html>
<html lang="en">
<head>
  <base href="../../">

  <title>Developer Testing</title>

  <link href="examples/style.css" rel="stylesheet">
  <link href="build/cookieconsent.min.css" rel="stylesheet">

  <style>
    /* custom these css for 'cc-theme-custom-floating' */

    .cc-theme-custom-floating .cc-cookie-image {
      position: absolute;
      bottom: 1em;
      right: 1em;
      opacity:.8;
      filter: invert(1);
      -webkit-filter: invert(1);
    }
    .cc-theme-custom-floating .cc-cookie-image:hover {
      opacity:1;
    }

    .cc-theme-custom-floating>.cc-link {
      margin: 0;
    }
  </style>

<body role="document">

  <div class="example-window">
    <h1>Testing floating popups</h1>
    <p>Look at all the layouts on screen and see if any look wrong</p>

    <select id="theme" class="selectbox"></select>
    <select id="palette" class="selectbox"></select>

    <br><br>

    <button onclick="javascript: window.location = 'examples/tests/test-banner.html';">Next test</button>
  </div>


<script src="build/cookieconsent.min.js"></script>
<script>

  var defaultOptions = {};

  var popupInstances = [
    cookieconsent.factory(defaultOptions),
    cookieconsent.factory(defaultOptions),
    cookieconsent.factory(defaultOptions),
    cookieconsent.factory(defaultOptions),
  ];

  var $theme = document.getElementById('theme');
  var $palette = document.getElementById('palette');

  var PALETTES = cookieconsent.Popup.getPalettes();
  var THEMES = cookieconsent.Popup.getThemes()
    .filter(function(cur){return /\-floating$/.test(cur)})
    .concat(['custom-floating']);

  var arrayToSelectboxOptions = function(v, k) {
    return '<option value="' + v + '">' + pretty(v) + '</option>'
  };

  fillSelect($theme, THEMES, arrayToSelectboxOptions);
  fillSelect($palette, PALETTES, arrayToSelectboxOptions);

  $theme.onchange = function (e) { update() };
  $palette.onchange = function (e) { update() };

  update();


  function getInputs () {
    return {
      theme: $theme[$theme.selectedIndex].value,
      palette: $palette[$palette.selectedIndex].value,
    }
  }

  function getOptions (inputs) {
    return {
      theme: inputs.theme,
      palette: inputs.palette,

      // although these config options will go to all the instances of cookie windows,
      // it only matters to the windows which have themes which uses these elements
      content: {
        cookieImage: 'http://plainicon.com/dboard/userprod/2921_4eb4c/prod_thumb/plainicon.com-64226-256px-fa8.png',
      },
      elements: {
        cookieImage: '<img class="cc-cookie-image" src="{children}" width="32px"/>',
      },
      themes: {
        'custom-floating': '{header}{message}{link}{close}{cookieImage}',
      },
    }
  }

  function draw(opts) {
    popupInstances[0].initialise(Object.assign({}, defaultOptions, opts, {type: 'dismiss', position: 'top-left'})).open();
    popupInstances[1].initialise(Object.assign({}, defaultOptions, opts, {type: 'info',    position: 'top-right'})).open();
    popupInstances[2].initialise(Object.assign({}, defaultOptions, opts, {type: 'opt-in',  position: 'bottom-left'})).open();
    popupInstances[3].initialise(Object.assign({}, defaultOptions, opts, {type: 'opt-out', position: 'bottom-right'})).open();
  }

  function update () {
    draw(getOptions(getInputs()));
  }

  function pretty (str) {
    return str[0].toUpperCase() + str.slice(1).replace(/\-/g, ' ');
  }

  function fillSelect (select, options, cb) {
    var html = '';
    if (typeof cb != 'function') {
      cb = function(v, k) { return '<option value="' + k + '">' + v + '</option>' };
    }
    for (var prop in options) {
      html += cb(options[prop], prop);
    }
    select.innerHTML = html;
  }

</script>
