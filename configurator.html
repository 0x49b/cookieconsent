<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Testing cookie consent</title>

    <link href="build/cookieconsent.min.css" rel="stylesheet">

    <style>
      .configurator-form {max-width: 400px; margin: 100px auto}
      .configurator-form>fieldset {margin-bottom: 10px}

      .col-1, .col-2 {width: 180px; display:inline-block}

      .block label {display: block}

      .textboxes label {max-width: 400px;line-height: 1.6}
      .textboxes label>input {float: right}

      .colours input[name="palette"] {display:none}
      .colours input[name="palette"]:checked + img {box-shadow: 0 0 10px 3px #888}

      #code {
        word-wrap: break-word;
        word-break: break-word;
      }
    </style>
  </head>

  <body role="document">
    <form class="configurator-form">

      <fieldset class="block">
        <legend>Choose layout</legend>
        <div class="col-1">
          <label for="layout-t"><input id="layout-t" type="radio" name="layout" value="banner-top" checked> Top</label>
          <label for="layout-tl"><input id="layout-tl" type="radio" name="layout" value="top-left"> Top left</label>
          <label for="layout-tr"><input id="layout-tr" type="radio" name="layout" value="top-right"> Top right</label>
        </div>
        <div class="col-2">
          <label for="layout-b"><input id="layout-b" type="radio" name="layout" value="banner-bottom"> Bottom</label>
          <label for="layout-bl"><input id="layout-bl" type="radio" name="layout" value="bottom-left"> Bottom left</label>
          <label for="layout-br"><input id="layout-br" type="radio" name="layout" value="bottom-right"> Bottom right</label>
        </div>
      </fieldset>

      <fieldset class="block">
        <legend>Choose cookie compliance</legend>
        <label for="compliance-i"><input id="compliance-i" type="radio" name="compliance" value="info" checked> Just tell users that we use cookies</label>
        <label for="compliance-oi"><input id="compliance-oi" type="radio" name="compliance" value="opt-in"> Let users opt-out of cookies</label>
        <label for="compliance-oo"><input id="compliance-oo" type="radio" name="compliance" value="opt-out"> Ask users to opt-into cookies</label>
      </fieldset>

      <fieldset class="block textboxes">
        <legend>Customise text</legend>
        <label for="ctext-header"> Header Text <input id="ctext-header" type="text" name="text-header" value=""></label>
        <label for="ctext-message"> Message Text <input id="ctext-message" type="text" name="text-message" value=""></label>
        <label for="ctext-allow"> Allow button text <input id="ctext-allow" type="text" name="text-allow" value=""></label>
        <label for="ctext-deny"> Deny button text <input id="ctext-deny" type="text" name="text-deny" value=""></label>
        <label for="ctext-dismiss"> Dismiss button text <input id="ctext-dismiss" type="text" name="text-dismiss" value=""></label>
        <label for="ctext-link"> Read more button text <input id="ctext-link" type="text" name="text-link" value=""></label>
        <label for="ctext-href"> Your cookie policy <input id="ctext-href" type="text" name="text-href" value=""></label>
      </fieldset>

      <fieldset class="colours">
        <legend>Colours</legend>
        <label for="palette-1">
          <input id="palette-1" type="radio" name="palette" value="black-orange" checked>
          <img src="http://labo.acclaim.pl/insites-cookie-consent/wp-content/themes/insites-cookie-consent/images/icon__choose-colour--1.svg">
        </label>
        <label for="palette-2">
          <input id="palette-2" type="radio" name="palette" value="green-green">
          <img src="http://labo.acclaim.pl/insites-cookie-consent/wp-content/themes/insites-cookie-consent/images/icon__choose-colour--2.svg">
        </label>
        <label for="palette-3">
          <input id="palette-3" type="radio" name="palette" value="blue-grey">
          <img src="http://labo.acclaim.pl/insites-cookie-consent/wp-content/themes/insites-cookie-consent/images/icon__choose-colour--3.svg">
        </label>
        <label for="palette-4">
          <input id="palette-4" type="radio" name="palette" value="grey-black">
          <img src="http://labo.acclaim.pl/insites-cookie-consent/wp-content/themes/insites-cookie-consent/images/icon__choose-colour--4.svg">
        </label>
        <label for="palette-5">
          <input id="palette-5" type="radio" name="palette" value="red-white">
          <img src="http://labo.acclaim.pl/insites-cookie-consent/wp-content/themes/insites-cookie-consent/images/icon__choose-colour--5.svg">
        </label>
        <label for="palette-6">
          <input id="palette-6" type="radio" name="palette" value="purple-white">
          <img src="http://labo.acclaim.pl/insites-cookie-consent/wp-content/themes/insites-cookie-consent/images/icon__choose-colour--6.svg">
        </label>
      </fieldset>

      <fieldset>
        <legend>Get the code</legend>
        <p>Just before the <code>&lt;/head&gt;</code> tag, add the following code:</p>
        <code id="code"></code>
        <p>If you need help, see our <a href="">documentation</a></p>
        <button onclick="event.preventDefault(); window.location = 'injector.html';">Test code here</button>
      </fieldset>

    <form>
  </body>
</html>

<!--script src="../build/cookieconsent.min.js"></script-->
<script src="cookieconsent.js"></script>
<script>

  var form = document.querySelector('.configurator-form');

  form.onchange = function () {
    draw(getOptions(getInputs()));
  };

  draw(getOptions(getInputs()));

  function draw(options) {
    var name = '__cookieconsent_popup';
    if (!window[name]) {
      window[name] = cookieconsent.factory(options);
    } else {
      window[name].initialise(options);
    }
    window[name].open();

    setCode(getCode(options));
  }

  function getOptions(input) {
    var content = {};
    var t = input.text;

    if (t.header)  content.header = t.header;
    if (t.message) content.message = t.message;
    if (t.dismiss) content.dismiss = t.dismiss;
    if (t.allow)   content.allow = t.allow;
    if (t.deny)    content.deny = t.deny;
    if (t.link)    content.link = t.link;

    var options = {
      // select your type of popup here
      type: input.compliance,
      palette: input.palette,
      position: input.layouts,

      // chooses between basic-banner and basic-floating depending on the position selected
      theme: /^banner\-/.test(input.layouts) ? 'basic-banner' : 'all-floating',
    };

    if (Object.keys(content).length) {
      options.content = content;
    }

    return options;
  }

  function getInputs () {
    return {
      text: {
        header: document.querySelector('[name="text-header"]').value,
        message: document.querySelector('[name="text-message"]').value,
        allow: document.querySelector('[name="text-allow"]').value,
        deny: document.querySelector('[name="text-deny"]').value,
        dismiss: document.querySelector('[name="text-dismiss"]').value,
        link: document.querySelector('[name="text-link"]').value,
        href: document.querySelector('[name="text-href"]').value,
      },
      layouts: document.querySelectorAll('[name="layout"]:checked').item(0).value,
      palette: document.querySelectorAll('[name="palette"]:checked').item(0).value,
      compliance: document.querySelectorAll('[name="compliance"]:checked').item(0).value,
    }
  }

  function getCode (config) {
    // this code will be displayed on the page. it is meant to be copied & pasted
    var json = JSON.stringify(config);
    return escapeHtml('<scr'+'ipt>(window["cookieconsent"] && window["cookieconsent"].autoOpen('+json+')) || console.error("cookieconsent.js has not been included")</scr'+'ipt>');
  }

  function setCode (code) {
    document.getElementById('code').innerHTML = code;
  }

  function escapeHtml(html) {
    // let the spec decide how to escape the html
    var text = document.createTextNode(html);
    var div = document.createElement('div');
    div.appendChild(text);
    return div.innerHTML;
  }

</script>
