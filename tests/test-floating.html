<!DOCTYPE html>
<html lang="en">
  <head>
    <base href="../" />

    <title>Testing cookie consent</title>

    <link href="tests/test-style.css" rel="stylesheet">
    <link href="build/cookieconsent.min.css" rel="stylesheet">

    <style>
      /* custom these css for 'cc-theme-custom-floating' */

      .cc-theme-custom-floating .cc-cookie-image {
        position: absolute;
        bottom: 1em;
        right: 1em;
        opacity:.8;
        filter: invert(1);
        -webkit-filter: invert(1);
      }
      .cc-theme-custom-floating .cc-cookie-image:hover {
        opacity:1;
      }

      .cc-theme-custom-floating>.cc-link {
        margin: 0;
      }
    </style>
  </head>

  <body role="document">

    <div class="example-window">
      <h1>Testing floating popups</h1>
      <p>Look at all the layouts on screen and see if any look wrong</p>

      <select id="theme">
        <option value="mono-floating">Mono</option>
        <option value="all-floating">Header / Close</option>
        <option value="centered-floating">Centered</option>
        <option value="custom-floating">Custom</option>
      </select>

      <select id="palette">
        <option value="blue">Blue</option>
        <option value="red">Red</option>
        <option value="white">White</option>
        <option value="black">Black</option>
        <option value="">No Palette</option>
      </select>

      <br><br>

      <button onclick="javascript: window.location = 'tests/test-banner.html';">Next test</button>
    </div>

  </body>
</html>

<!--script src="../build/cookieconsent.min.js"></script-->
<script src="cookieconsent.js"></script>
<script>

  // this page tests a single theme against all it's options

  var themeSelector = document.getElementById('theme');
  var paletteSelector = document.getElementById('palette');

  var _popups = [];
  var _options = {
    theme: themeSelector[0].value,
    palette: paletteSelector[0].value,

    // although these config options will go to all the instances of cookie windows,
    // it only matters to the windows which have themes which uses these elements
    content: {
      cookieImage: 'http://plainicon.com/dboard/userprod/2921_4eb4c/prod_thumb/plainicon.com-64226-256px-fa8.png',
    },

    elements: {
      cookieImage: '<img class="cc-cookie-image" src="{children}" width="32px"/>',
    },

    themes: {
      'custom-floating': '{header}{message}{link}{close}{cookieImage}',
    },
  };

  themeSelector.onchange = function (e) {
    _options.theme = e.target.value;
    run(_options);
  };

  paletteSelector.onchange = function (e) {
    _options.palette = e.target.value;
    run(_options);
  };

  run(_options);

  // ---------------------------------------------------------

  function run(commonOptions) {
    if (_popups.length) {
      callPopupMethod(_popups, 'destroy', []);
      _popups = [];
    }
    initPopups(_popups, commonOptions, [
      {type: 'dismiss', position: 'top-left'},
      {type: 'info',    position: 'top-right'},
      {type: 'opt-in',  position: 'bottom-left'},
      {type: 'opt-out', position: 'bottom-right'},
    ]);
  }

  function initPopups (popups, commonOpts, arrayOfOpts) {
    arrayOfOpts.forEach(function (opts) {
      var myOpts = Object.assign({}, commonOpts, opts);

      // so we don't end up with many wrappers, we'll make all cookie windows use the same wrapper
      if (popups.length) {
        myOpts.container = document.querySelector('.cc-wrapper');
        myOpts.useWrapper = false;
      }

      popups.push(cookieconsent.autoOpen(myOpts));
    });
  }

  function callPopupMethod(popups, method, args) {
    return popups.map(function (popup) {
      return popup[method].apply(popup, args);
    });
  }

</script>
